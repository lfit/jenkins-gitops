---
# Cloud Agent Configuration
#
# Kubernetes cloud configuration for dynamic Jenkins build agents.
# Agents are created as pods in the Kubernetes cluster on demand.
#
# JCASC_KUBERNETES_URL: Kubernetes API server URL for cluster access
# JCASC_KUBERNETES_NAMESPACE: Namespace for creating agent pods
# JCASC_KUBERNETES_JENKINS_URL: Jenkins URL accessible from agent pods
# JCASC_KUBERNETES_JENKINS_TUNNEL: Jenkins agent port for JNLP connection
#
# Agent pods are automatically created for builds and cleaned up after
# build completion.
#
jenkins:
  clouds:
    - kubernetes:
        name: "kubernetes"
        serverUrl: "${JCASC_KUBERNETES_URL:-https://kubernetes.default.svc.cluster.local}"
        namespace: "${JCASC_KUBERNETES_NAMESPACE:-default}"
        credentialsId: ""
        jenkinsUrl: "${JCASC_KUBERNETES_JENKINS_URL:-http://jenkins:8080}"
        jenkinsTunnel: "${JCASC_KUBERNETES_JENKINS_TUNNEL:-jenkins:50000}"
        containerCap: 10
        maxRequestsPerHostStr: "32"
        retentionTimeout: 180
        connectTimeout: 10
        readTimeout: 20
        waitForPodSec: 600
        usageRestricted: false
        garbageCollection:
          timeout: 300
        podLabels:
          - key: "jenkins"
            value: "slave"
          - key: "app.kubernetes.io/managed-by"
            value: "jenkins"
          - key: "app.kubernetes.io/part-of"
            value: "cicd"
        templates:
          - name: "default-agent"
            label: "kubernetes"
            nodeUsageMode: "NORMAL"
            containers:
              - name: "jnlp"
                image: "jenkins/inbound-agent:latest"
                args: "^${computer.jnlpmac} ^${computer.name}"
                resourceRequestCpu: "200m"
                resourceRequestMemory: "256Mi"
                resourceLimitCpu: "500m"
                resourceLimitMemory: "512Mi"
            podRetention: "default"
            activeDeadlineSeconds: 3600
            idleMinutes: 5
