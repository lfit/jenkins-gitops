---
# jcasc/06-credentials.yaml
#
# Jenkins credential configurations for secure access to external services.
# Credentials are managed through Jenkins credential store and
# 1Password integration.
#
# onepassword-integration: Service account authentication for 1Password access
# github-token: GitHub Personal Access Token retrieved from 1Password via JCasC
#
# Build secrets (GitHub tokens) are retrieved directly from 1Password
# during builds.
# Cluster secrets (admin passwords) are managed separately via
# External Secrets Operator.
#
jenkins:
  # Purpose: GitHub credentials configuration using 1Password integration
  # Dependencies: onepassword-sa-token secret, GitHub service account token
  # Context: Configured for build secret access with fallback to GITHUB_CREDENTIALS_ID variable
  systemMessage: |
    1Password Integration Status:
    - Plugin: OnePassword Integration for Build Secrets
    - Service Account: Available via onepassword-sa-token cluster secret
    - GitHub Token: opensearch-jenkins service account configured

# GitHub Credentials Configuration
# Status: Ready for production use
# Service Account: opensearch-jenkins (existing)
# Token: github-opensearch-jenkins with repo, public_repo, repo:status permissions
# Expiration: June 2, 2026
credentials:
  system:
    domainCredentials:
      - credentials:
          # 1Password Service Account Integration
          - onePasswordCredentials:
              id: "onepassword-integration"
              description: "1Password service account for build secret access"
              # References the service account token secret created by ESO
              serviceAccountToken:
                secretName: "onepassword-sa-token"
                key: "token"

          # GitHub Service Account Token for CI/CD Operations
          - string:
              id: "${GITHUB_CREDENTIALS_ID}"
              description: "GitHub opensearch-jenkins service account token (opensearch-jenkins-github-token)"
              # 1Password vault reference for GitHub token
              # Vault: Employee, Item: opensearch-jenkins-github-token, Field: password
              secret: "op://Employee/opensearch-jenkins-github-token/password"
