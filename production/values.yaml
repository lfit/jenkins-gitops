---
# Name: production/values.yaml
# Purpose: Production environment Helm values for Jenkins wrapper chart configuration
# Description: Environment-specific overrides for production deployment including
# image versioning, resource allocation, JVM optimization, and JCasC variables.
# Inherits base configuration from base/jenkins/values.yaml.
#
# persistence.size: Production-appropriate storage allocation (16Gi)
# jenkins.controller.image: Production image tag and pull policy for reliability
# jenkins.controller.resources: Resource limits appropriate for production workloads
# jenkins.controller.javaOpts: JVM tuning for production memory allocation
# jenkins.controller.containerEnv: Environment variables for JCasC configuration
# jenkins.controller.ingress: External access configuration for production environment

# Production-specific persistence configuration
# Storage size configured in jenkins.persistence section below

# Jenkins subchart configuration overrides
# Inherits base configuration from: base/jenkins/values.yaml
jenkins:
  # Service account configuration for AWS IAM role assumption
  serviceAccount:
    annotations:
      "eks.amazonaws.com/role-arn": "arn:aws:iam::156041419073:role/jenkins-prod-irsa"

  controller:
    # Container image configuration for production environment
    # Uses specific commit SHA for production stability
    # Pull policy set to Always for latest security updates
    image:
      registry: "ghcr.io"
      repository: "lfit/jenkins"
      tag: "main-990a6cc"
      pullPolicy: "Always"

    # Plugin management - use only plugins baked into image
    # Prevents plugin version conflicts in production environment
    installPlugins: false

    # Jenkins Configuration as Code
    # Complete JCasC configuration for production environment
    JCasC:
      defaultConfig: false

    # Resource allocation for production environment
    # Higher resource limits appropriate for production workloads
    resources:
      requests:
        cpu: "2000m"
        memory: "4Gi"
      limits:
        cpu: "4000m"
        memory: "8Gi"

    # JVM optimization for production environment
    # Memory settings aligned with resource limits above
    javaOpts: >-
      -XX:+UseG1GC
      -XX:+UseStringDeduplication
      -XX:+ParallelRefProcEnabled
      -XX:+DisableExplicitGC
      -XX:+UnlockExperimentalVMOptions
      -XX:G1NewSizePercent=20
      -XX:+UnlockDiagnosticVMOptions
      -XX:G1MixedGCCountTarget=16
      -XX:G1MixedGCLiveThresholdPercent=90
      -XX:G1RSetUpdatingPauseTimePercent=5
      -XX:G1HeapRegionSize=32M
      -Xmx6g
      -XX:MaxMetaspaceSize=512m

    # Environment variables for Jenkins container (JCasC configuration)
    # Variables consumed by: base/jenkins/jcasc_yamls/ configuration files
    # Environment-specific values for production deployment context
    containerEnv:
      # System Configuration (01-global-env-vars.yaml)
      - name: JCASC_SILO
        value: "production"
      - name: JCASC_JENKINS_URL
        value: "https://jenkins.opensearch.cluster.linuxfound.info/"
      - name: JENKINS_URL
        value: "https://jenkins.opensearch.cluster.linuxfound.info/"
      - name: JCASC_LOCATION_URL
        value: ""
      - name: JCASC_LOCATION_ADMINADDRESS
        value: ""
      - name: JCASC_SYSTEM_MESSAGE
        value: "Welcome to Jenkins (Production Environment)"
      - name: JCASC_MASTER_LABELS
        value: "prod-controller"
      - name: JCASC_RESOURCE_ROOT_URL
        value: ""

      # Build and Performance Configuration
      - name: JCASC_BUILD_TIMEOUT
        value: "7200"
      - name: JCASC_MAVEN_OPTS
        value: "-Xmx4096m -XX:MaxMetaspaceSize=1024m"
      - name: JCASC_NODE_OPTIONS
        value: "--max-old-space-size=8192"
      - name: JCASC_SCM_POLLING_THREADCOUNT
        value: "10"

      # Integration Configuration (placeholders for future configuration)
      - name: JCASC_LOG_LEVEL
        value: "ERROR"
      - name: JCASC_ARTIFACTORY_URL
        value: ""
      - name: JCASC_DOCKER_REGISTRY
        value: ""
      - name: JCASC_S3_BUCKET
        value: ""
      - name: JCASC_CDN_URL
        value: ""
      - name: JCASC_ARTIFACTS_RETENTION_DAYS
        value: ""
      - name: JCASC_ECR_REGISTRY_URL
        value: ""

      # Security Configuration (02-security.yaml integration)
      - name: JCASC_ADMIN_PASSWORD
        valueFrom:
          secretKeyRef:
            name: jenkins-lf-admin
            key: admin-password

      # Kubernetes Cloud Configuration (07-cloud-agents.yaml integration)
      - name: JCASC_KUBERNETES_URL
        value: "https://kubernetes.default.svc.cluster.local"
      - name: JCASC_KUBERNETES_NAMESPACE
        value: "jenkins-production"
      - name: JCASC_KUBERNETES_JENKINS_URL
        value: "http://jenkins-production.jenkins-production.svc.cluster.local:8080"
      - name: JCASC_KUBERNETES_JENKINS_TUNNEL
        value: "jenkins-production-agent.jenkins-production.svc.cluster.local:50000"

    # External access configuration for production environment
    # Provides public access for production workflows
    ingress:
      enabled: true
      apiVersion: networking.k8s.io/v1
      ingressClassName: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt
      hostName: jenkins.opensearch.cluster.linuxfound.info
      path: /
      tls:
        - secretName: jenkins-production-tls
          hosts:
            - jenkins.opensearch.cluster.linuxfound.info

  # Defining resource requests and limits for the production environment.
  resources:
    requests:
      cpu: "2000m"
      memory: "4Gi"
    limits:
      cpu: "4000m"
      memory: "8Gi"

  jenkinsJavaOpts: "-Xms2g -Xmx6g"

  persistence:
    enabled: true
    storageClass: "auto-ebs-sc"
    size: "16Gi"
